<template>
 	<require from='../resources/filter-on-property'></require>
 	<require from='../resources/take'></require>
 	<require from='../resources/sort'></require>
 	<require from='../resources/sum'></require>
 	<require from='../resources/user-icon'></require>
 	<require from='../resources/days-until-milestone'></require>
 	<require from='../resources/property-frequency'></require>
 	<require from='../resources/reduce-object'></require>
       
  <section class="au-animate main-content-wrapper">
    <div class="pure-g">
      <div class="pure-u-1-4 pure-u-sm-1-6">
        <img id="profilePicture" src.bind="data[0].user.avatar_image.url" class="floatme pure-img ${showBanner? 'clean' : ''}" click.trigger="toggleVisible($event)"
        />
      </div>
      <div id="banner" class="pure-u-1 pure-u-sm-5-6 ${showBanner? 'clean' : ''}" css="background-image: url(${data[0].user.cover_image.url});">
        <div class="pure-g">
          <div id="profileDetails" class="pure-u-1 pure-u-md-4-5  pure-u-lg-2-3 ${showBanner? 'clean' : ''}">
            <h2>
              <i class="fa fa-${data[0].user.type | userIcon}"></i> ${data[0].user.name}
              <small>@
                <input type="text" id="un" value.bind="user_id" change.delegate="loadUserRoute()" />
              </small> 
              <i class="fa fa-random randomize" click.delegate="loadRandomUserRoute()"></i>
            </h2>
            <p>
              <span innerHTML.one-way="data[0].user.description.html" click.delegate="postclicks.handler($event)"></span>
              <br />
              <br />
              <i if.bind='data[0].user.verified_link' class="fa fa-check-circle"></i>
              <a href="${data[0].user.verified_link}" target="_blank">${data[0].user.verified_domain}</a>
              <a href="https://app.net/${user_id}" target="_blank"><i class="fa fa-adn"></i> Profile</a>
            </p>
            <nav class="pure-menu pure-menu-horizontal">
              <ul class="pure-menu-list">
                <li class="pure-menu-item">
                  <a class="pure-menu-link" href="#"><i class="fa fa-arrow-circle-left"></i> ${data[0].user.counts.following}</a>
                </li>
                <li class="pure-menu-item">
                  <a class="pure-menu-link" href="#"><i class="fa fa-arrow-circle-right"></i> ${data[0].user.counts.followers}</a>
                </li>
                <li class="pure-menu-item">
                  <a class="pure-menu-link" href="#"><i class="fa fa-pencil-square-o"></i> ${data[0].user.counts.posts}</a>
                </li>
                <li class="pure-menu-item">
                  <a class="pure-menu-link" href="#"><i class="fa fa-star"></i> ${data[0].user.counts.stars}</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
    <div class="pure-g posts" if.bind="data[0].user.counts.posts>0">
      <div class="pure-u-1 stats-header">
        <h2>Last ${data.length} Posts <a href="#" click.delegate="loadMorePosts()">more...</a></h2>
      </div>
      <div class="pure-u-1 stats">
        <div class="pure-g">
          <div class="pure-u-1 pure-u-sm-1-2">
            <p>
              <strong>${data | sum:'num_replies'}</strong> replied to, <strong>${data | sum:'num_reposts'}</strong> reposted and <strong>${data | sum:'num_stars'}</strong> starred.</p>
            <p>Last Posted <strong>${data[0].created_at | time }</strong> hours ago<span if.bind='data.length>1'> and ${data.length} posts before that it was <strong>${data[data.length-1].created_at | time}</strong> hours ago</span>.</p>
              <p if.bind="data[0].user.counts.posts<100000 && data[0].user.counts.posts>1">Based on the current rate it will be ${data | daysUntilMilestone:100000} days before 100,000 posts is reached. Yay for arbitrary milestones!</p>
          </div>
          <div class="pure-u-1 pure-u-sm-1-2">
            <p>Mostly mentioning
              <span repeat.for="men of data | reduceObject:'entities':'mentions' | propertyFrequency:'name' | sort: { propertyName: 'count', direction: 'descending' } | take:numberOfTopMentions">
                <a href="#" click.delegate="$parent.loadUserRoute(men.name)">@${men.name}</a>(<strong>${men.count}</strong>)${$index
                <=numberOfTopMentions ? ',': ''}</span> <a href="#" click.delegate="moreMentions()">more...</a>
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="modal">
      <p repeat.for="image of loadImages | filterOnProperty:'type':'net.app.core.oembed'"><img src="${image.value.thumbnail_url}" /></p>
      <p>html</p>
      <p>Post Date</p>
      <p>Interactions</p>
      <p>Files</p>
      <p>Annotations</p>
    </div>    
		<div class="pure-g posts">
			<div class="pure-u-lg-1-3 pure-u-sm-1-2 pure-u-1 post" repeat.for="post of data">
        <a href="#" click.trigger="$parent.toggleDetails($event, post)"><i class="fa fa-repeat"></i></a>
				<div class="pure-g">
					<div class="pure-u-1 post-details ${post.hidePost? '' : 'showMe'}" ">
						<p><a href="#" click.trigger="$parent.getPost(post.id)">Open Post</a></p>
            <p innerHTML.one-way="post.html"  click.delegate="$parent.postclicks.handler($event) "></p>
						<p>Posted on ${post.created_at | dateFormat:'DD-MMM-YYYY'} at ${post.created_at | dateFormat:'HH:mm'}</p>
					</div>
					<div class="pure-u-1 post-details ${post.hidePost? 'showMe' : ''} "">
						<p>
							${post.num_replies} <i class="fa fa-reply
					"></i> ${post.num_reposts}
							<i class="fa fa-retweet "></i> ${post.num_stars}
							<i class="fa fa-star "></i> <a href.bind="post.canonical_url" target="_blank"><i class="fa fa-adn "></i> Post</a></p>
						<p>Posted with <a href.bind="post.source.link" target="_blank">${post.source.name}</a></p>
					</div>
				</div>
			</div>
  </section>
</template>